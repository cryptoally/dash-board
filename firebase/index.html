<!DOCTYPE html>
<html>
  <head>
    <title>DASH BOARD</title>
    <meta name="DASH STATISTICS BOARD" content="Dash is a privacy-centric digital currency. Dash-Stats board shows statistics about the network and price. Masternodes, hashing power, difficulty, DASH-BTC, DASH-USD, BTC-USD. Darkcoin is now DASH.Bitcoin fork.">
    <meta http-equiv="content-type" content="text/html;charset=UTF-8">
    <META NAME="ROBOTS" CONTENT="INDEX, NOFOLLOW">
    <!-- Bootstrap -->
    <link href="bootstrap-3.3.5-dist/css/bootstrap.min.css" rel="stylesheet" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
    <link href='style.css' rel='stylesheet' type='text/css'>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-64485063-2', 'auto');
  ga('send', 'pageview');

</script>
  </head>
  <body>
    <div class="modal fade" id="about">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">Dash board</h4>
      </div>
      <div class="modal-body">
        <p>This board shows <a href="https://www.dashpay.io/" target="_blank">DASH</a> network statistics, updated once a minute.</p>
        <p>Prices are an average value from top volume exchanges.</p>
        <p>Charts are loaded with last 12 hours data and filled to last 24 hours. New values are added once every 14 minutes.</p>
        <p><a href="https://twitter.com/dashmasternode" target="_blank">dashmasternode</a> will tweet masternodes count once a day</p>
        <p><a href="https://github.com/mjsrs/dash-board" target="_blank">GitHub</a></p>
        <p>buy me a beer with some DASH: XtXT8gqpkkkGgtsSY8T7m58jQR3gmHeeZe</p>
        <p><a href="https://dash-proposals.firebaseapp.com/"  target="_blank">dash-proposals</a></p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
    <div class="mask"><div class="loading"><h1 id="loading_msg">preparing the board</h1></div></div>
        <div class="container-fluid" width="100%" height="100%">
            <div class="row">
                <div class="col-md-4">
                    <div class="jumbotron">
                        <h1 id="masternodecount">0</h1>
                        <span class="masternodes_chart chart"></span>
                        <p>masternodes on the network</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="jumbotron">
                        <h1 id="hashrate">0</h1>
                        <span class="hashrate_chart chart"></span>
                        <p>GH/s of hashing power</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="jumbotron">
                        <h1 id="difficulty">0</h1>
                        <span class="difficulty_chart chart"></span>
                        <p>DASH difficulty </p>
                        
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-4">
                    <div class="jumbotron">
                        <h1 id="priceBTC">0</h1>
                        <span class="priceBTC_chart chart"></span>
                        <p>BTC for one DASH </p>
                        
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="jumbotron">
                        <h1 id="price">$0</h1>
                        <span class="price_chart chart"></span>
                        <p>for one DASH</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="jumbotron">
                        <h1 id="priceBTCUSD">0</h1>
                        <span class="priceBTCUSD_chart chart"></span>
                        <p>for one BTC</p>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-4">
                    <div class="jumbotron">
                        <h1 id="lastblock">0</h1>
                        <p style="margin-bottom:0">last block found</p>
                        <p id="superblock" style="font-size:12px">.</p>
                    </div>
                </div>
                <div class="col-md-4">
                   <div class="jumbotron">
                        <h1 id="availablesupply">0</h1>
                        <p style="margin-bottom:0">available DASH</p>
                        <p id="percentOnMasternodes" style="font-size:12px">.</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="jumbotron">
                        <h1 id="enforcement">On</h1>
                        <p style="margin-bottom:0">payment enforcement status</p>
                        <p style="font-size:12px">.</p>
                    </div> 
                </div>
            </div>
        </div>
    <footer class="footer">
        <div class="container">
            <div class="muted" id="lastupdate" style="float:left"></div>
            <div class="muted" style="float:right"><a href="#" data-toggle="modal" data-target="#about">About</a></div>
        </div>
    </footer>


    <script type="text/javascript" src="firebase.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script type="text/javascript" src="jquery.sparkline/dist/jquery.sparkline.js"></script>
    <script type="text/javascript" src="bootstrap-3.3.5-dist/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.3/moment.min.js"></script>
    <script type="text/javascript">
      //Vars initialization
      var chart_resolution = 14.4*60; //14.4 minutes * 60 seconds
      var chart_length = 100; //number of values
      var chart_defaults = {height:"30px", lineColor:"#1A237E", fillColor:"#1e73be"};
      var chart_initial_length = 34;
      var records_to_load = 718;
      var records_loaded = 0;
      //console.log("Charts range is "+14.4*100 / 60+"h"); //24h

      var difficulty_points = [];
      var hashrate_points = [];
      var price_points = [];
      var priceBTC_points = [];
      var priceBTCUSD_points = [];
      var masternodes_points = [];
      
      var _timestamp;          //board update timestamp
      var last_timestamp = 0;  //last child added timestamp;


      var presence = new Firebase("https://dash-stats.firebaseio.com/presence/");
      var user = presence.push();

      var connection = new Firebase("https://dash-stats.firebaseio.com/.info/connected");
      connection.on("value", function(snap){
        if(snap.val()){
          user.onDisconnect().remove();
          user.set({ startedAt: Firebase.ServerValue.TIMESTAMP, lastSeen:  Firebase.ServerValue.TIMESTAMP});
        }
      });

      var url = "https://dash-stats.firebaseio.com/stats";
      var dashstats = new Firebase(url);

      dashstats.orderByKey().limitToLast(records_to_load).on("child_added", function(snapshot) {

        user.child('lastSeen').set(Firebase.ServerValue.TIMESTAMP);
        _timestamp = new Date(snapshot.val().timestamp);
        var timestamp_time_since = moment(_timestamp).fromNow();

        //update board values
        $("h1[id=masternodecount]").html(snapshot.val().masternodecount);
        $("div[id=lastupdate]").html("this board was updated "+timestamp_time_since);
        $("h1[id=hashrate]").html(snapshot.val().hashrate);
        $("h1[id=lastblock]").html(snapshot.val().lastblock);
        $("h1[id=price]").html("$" + snapshot.val().price);
        document.title = "$" + snapshot.val().price + "  DASH BOARD";
        $("h1[id=priceBTC]").html(snapshot.val().priceBTC);
        $("h1[id=priceBTCUSD]").html("$" + snapshot.val().priceBTCUSD);
        $("h1[id=enforcement]").html(snapshot.val().enforcement);
        $("h1[id=difficulty]").html(snapshot.val().difficulty);
        $("h1[id=availablesupply]").html(snapshot.val().availablesupply);
        $("p[id=superblock]").html("next super block " + snapshot.val().superblock);
        var availablesupply = '' + snapshot.val().availablesupply;
        availablesupply = availablesupply.replace(/,/g,'');
        var percentOnMasternodes = 100 * (snapshot.val().masternodecount * 1000) / availablesupply;
        $("p[id=percentOnMasternodes]").html(Math.round(percentOnMasternodes * 100)/100 + "% on masternodes");


        
        records_loaded += 1;
        if(records_loaded >= records_to_load){
          $(".mask").hide();
          records_loaded = 0;
        }
        var timestamp = snapshot.val().timestamp/1000;  //child added timestamp
        if((timestamp - last_timestamp) > chart_resolution){
          last_timestamp = timestamp;
        }else{
          return;
        }
        if(difficulty_points.length >= chart_length){   //remove child from the chart
          difficulty_points.shift();
          hashrate_points.shift();
          price_points.shift();
          priceBTC_points.shift();
          priceBTCUSD_points.shift();
          masternodes_points.shift();
        }
        //add child values to arrays
        difficulty_points.push(snapshot.val().difficulty);
        hashrate_points.push(snapshot.val().hashrate);
        price_points.push(snapshot.val().price);
        priceBTC_points.push(snapshot.val().priceBTC);
        priceBTCUSD_points.push(snapshot.val().priceBTCUSD);
        masternodes_points.push(snapshot.val().masternodecount);

        //redo charts
        $('.difficulty_chart').sparkline(difficulty_points, chart_defaults);
        $('.hashrate_chart').sparkline(hashrate_points, chart_defaults);
        $('.price_chart').sparkline(price_points, chart_defaults);
        $('.priceBTC_chart').sparkline(priceBTC_points, chart_defaults);
        $('.priceBTCUSD_chart').sparkline(priceBTCUSD_points, chart_defaults);
        $('.masternodes_chart').sparkline(masternodes_points, chart_defaults);

      }, function (errorObject) {
        console.log("The read failed: " + errorObject.code);
      });

      setInterval(function(){  //this is just to update the footer text
        var timestamp_time_since = moment(_timestamp).fromNow();
        $("div[id=lastupdate]").html("this board was updated "+timestamp_time_since);
      }, 10000);

    </script>


  </body>
</html>
